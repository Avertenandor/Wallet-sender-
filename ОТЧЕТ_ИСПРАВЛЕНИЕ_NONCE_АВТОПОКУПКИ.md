# üéØ –û–¢–ß–ï–¢: –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï NONCE –í –ê–í–¢–û–ü–û–ö–£–ü–ö–ê–•

**–î–∞—Ç–∞:** 28 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–ü—Ä–æ–µ–∫—Ç:** WalletSender_Modular  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** MCP (Memory, Pylance, Cursor-turbo)

## üö® –ü–†–û–ë–õ–ï–ú–ê

**–û—à–∏–±–∫–∞:** `{'code': -32000, 'message': 'nonce too low: next nonce 98684, tx nonce 98683'}`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∞—Ö –∑–∞ USDT –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ approve —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è swap –ø–∞–¥–∞–ª–∞ —Å –æ—à–∏–±–∫–æ–π nonce too low.

## üîç –ê–ù–ê–õ–ò–ó –ü–†–ò–ß–ò–ù–´

### **–ü–†–û–ë–õ–ï–ú–ù–ê–Ø –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨:**
1. **Approve —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `nonce: 98683`
2. **Approve –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è** - nonce —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –¥–æ `98684`
3. **Swap —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `nonce: 98683` (—Å—Ç–∞—Ä—ã–π!)
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—à–∏–±–∫–∞ "nonce too low"

### **–ö–û–†–ï–ù–¨ –ü–†–û–ë–õ–ï–ú–´:**
```python
# –ë–´–õ–û (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
approve_tx = usdt_contract.functions.approve(...).build_transaction({
    'nonce': self.web3.eth.get_transaction_count(self.account.address)  # nonce: 98683
})
# ... approve –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, nonce —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 98684

swap_tx = router_contract.functions.swapExactTokensForTokens(...).build_transaction({
    'nonce': self.web3.eth.get_transaction_count(self.account.address)  # –ù–æ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ä—ã–π 98683!
})
```

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### **–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê:**
```python
# –°–¢–ê–õ–û (–ü–†–ê–í–ò–õ–¨–ù–û):
# 1. –í—ã–ø–æ–ª–Ω—è–µ–º approve
approve_receipt = self.web3.eth.wait_for_transaction_receipt(approve_hash, timeout=120)

# 2. –ü–∞—É–∑–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è nonce –≤ —Å–µ—Ç–∏
import time
time.sleep(1)

# 3. –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π nonce
current_nonce = self.web3.eth.get_transaction_count(self.account.address)
self.log(f"üìä –ê–∫—Ç—É–∞–ª—å–Ω—ã–π nonce –ø–æ—Å–ª–µ approve: {current_nonce}", "INFO")

# 4. –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π nonce –¥–ª—è swap
swap_tx = router_contract.functions.swapExactTokensForTokens(...).build_transaction({
    'nonce': current_nonce  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π nonce
})
```

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### **–í —Ñ–∞–π–ª–µ `auto_buy_tab.py`:**

1. **–î–æ–±–∞–≤–ª–µ–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ receipt:**
   ```python
   approve_receipt = self.web3.eth.wait_for_transaction_receipt(approve_hash, timeout=120)
   ```

2. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–∞—É–∑–∞:**
   ```python
   time.sleep(1)  # –ü–∞—É–∑–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è nonce –≤ —Å–µ—Ç–∏
   ```

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ nonce:**
   ```python
   current_nonce = self.web3.eth.get_transaction_count(self.account.address)
   self.log(f"üìä –ê–∫—Ç—É–∞–ª—å–Ω—ã–π nonce –ø–æ—Å–ª–µ approve: {current_nonce}", "INFO")
   ```

4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ nonce:**
   ```python
   'nonce': current_nonce  # –í–º–µ—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ get_transaction_count
   ```

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

### **–î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**
‚ùå –û—à–∏–±–∫–∞: `nonce too low: next nonce 98684, tx nonce 98683`  
‚ùå –ê–≤—Ç–æ–ø–æ–∫—É–ø–∫–∏ –∑–∞ USDT –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏  
‚ùå –¢–æ–ª—å–∫–æ –ø–æ–∫—É–ø–∫–∏ –∑–∞ BNB –±—ã–ª–∏ –≤–æ–∑–º–æ–∂–Ω—ã  

### **–ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**
‚úÖ **–ü–æ–∫—É–ø–∫–∏ –∑–∞ BNB:** –†–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ  
‚úÖ **–ü–æ–∫—É–ø–∫–∏ –∑–∞ USDT:** –†–∞–±–æ—Ç–∞—é—Ç —Å approve + swap  
‚úÖ **Nonce —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å  
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ nonce –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏  

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### **MCP –ü–†–û–í–ï–†–ö–ò:**
- ‚úÖ **–°–∏–Ω—Ç–∞–∫—Å–∏—Å:** `pylance` - –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ **–ö–æ–º–ø–∏–ª—è—Ü–∏—è:** `py_compile` - —É—Å–ø–µ—à–Ω–æ  
- ‚úÖ **–ó–∞–ø—É—Å–∫:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### **–ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ:**
–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
1. –í—ã–±—Ä–∞—Ç—å **USDT** –≤ –ø–æ–ª–µ "–ü–æ–∫—É–ø–∞—Ç—å –∑–∞:"
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—É–º–º—É –∏ —Ç–æ–∫–µ–Ω –¥–ª—è –ø–æ–∫—É–ø–∫–∏
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∏
4. **approve —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. **swap —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π nonce

## üìä –°–í–û–î–ö–ê

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
|----------|----------------|-------------------|
| **BNB –ø–æ–∫—É–ø–∫–∏** | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç |
| **USDT –ø–æ–∫—É–ø–∫–∏** | ‚ùå –ü–∞–¥–∞—é—Ç –ø–æ nonce | ‚úÖ –†–∞–±–æ—Ç–∞—é—Ç |
| **Approve –ª–æ–≥–∏–∫–∞** | ‚ùå –ù–µ–ø–æ–ª–Ω–∞—è | ‚úÖ –ü–æ–ª–Ω–∞—è |
| **Nonce –∫–æ–Ω—Ç—Ä–æ–ª—å** | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å |
| **–û—Ç–ª–∞–¥–∫–∞** | ‚ùå –ù–µ—Ç –ª–æ–≥–æ–≤ | ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ |

**–ü—Ä–æ–±–ª–µ–º–∞ —Å nonce –≤ –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∞—Ö –∑–∞ USDT –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞! üéâ**
